---
lab:
  title: 動画を分析する
  description: Azure AI Video Indexer を使用してビデオを分析します。
---

# 動画を分析する

今日作成および消費されているデータの大部分は動画形式です。 **Azure AI Video Indexer** は、AI を利用したサービスであり、動画のインデックスを作成し、動画からインサイトを抽出するために使用できます。

> **注**: 2022 年 6 月 21 日から、個人を特定できる情報を返す Azure AI サービスの機能は、[制限付きアクセス](https://docs.microsoft.com/azure/cognitive-services/cognitive-services-limited-access)が許可されているお客様に限定されます。 制限付きアクセスの承認を得ていない場合、このラボの Video Indexer を使用して人や著名人を認識することはできません。 Microsoft が行った変更と理由について詳しくは、「[顔認識に対する責任ある AI 投資と保護](https://azure.microsoft.com/blog/responsible-ai-investments-and-safeguards-for-facial-recognition/)」をご覧ください。

## 動画を Video Indexer にアップロードする

最初に、Video Indexer ポータルにサインインして、動画をアップロードする必要があります。

1. ブラウザーで、[Video Indexer ポータル](https://www.videoindexer.ai) (`https://www.videoindexer.ai`) を開きます。
1. 既存の Video Indexer アカウントがある場合は、サインインします。 それ以外の場合は、無料アカウントにサインアップし、Microsoft アカウント (またはその他の有効なアカウントの種類) を使ってサインインします。 サインインに問題がある場合は、プライベート ブラウザー セッションを開いてみてください。

    > 注:初めてサインインする場合は、サービスの使用を確認するように求めるポップアップ フォームが表示されることがあります。 

1. 新しいタブで、`https://aka.ms/responsible-ai-video` にアクセスして責任ある AI のビデオをダウンロードします。 ファイルを保存します。
1. Video Indexer で、**[アップロード]** オプションを選択します。 次に、**[ファイルを参照]** オプションを選び、ダウンロードしたビデオを選び、**[追加]** をクリックします。 **[ファイル名]** フィールドのテキストを **[Responsible AI]** に変更します。 **[確認とアップロード]** を選択して概要を確認し、顔認識に関する Microsoft のポリシーに準拠していることを確認するチェックボックスをオンにして、ファイルをアップロードします。
1. ファイルがアップロードされたら、Video Indexer が自動的にインデックスを作成するまで数分待ちます。

> **注**:この演習では、この動画を使用して Video Indexer の機能を調べます。ただし、AI 対応アプリケーションを責任を持って開発するための有用な情報とガイダンスが含まれているため、演習が終了したら、時間をかけて完全に確認する必要があります。 

## ビデオ インサイトの確認

インデックス作成プロセスは、ポータルで表示できる動画からインサイトを抽出します。

1. Video Indexer ポータルで、動画にインデックスが付けられたら、それを選択して表示します。 動画から抽出されたインサイトを示すペインの横にビデオ プレーヤーが表示されます。

    > **注**: 個人 ID を保護するためのアクセス ポリシーが制限されているため、ビデオのインデックスを作成するときに名前が表示されない場合があります。

    ![ビデオ プレーヤーと [インサイト] ペインを備えた Video Indexer](../media/video-indexer-insights.png)

1. 動画の再生中に、**[タイムライン]** タブを選択して、動画オーディオのトランスクリプトを表示します。

    ![ビデオ プレーヤーと動画トランスクリプトを表示するタイムライン ペインを備えた Video Indexer。](../media/video-indexer-transcript.png)

1. ポータルの右上にある **[表示]** 記号 (&#128455; に似ています) を選択し、インサイトのリストで、**[トランスクリプト]** に加えて、**[OCR]** と **[スピーカー]** を選択します。

    ![トランスクリプト、OCR、およびスピーカーが選択された Video Indexer メニュー](../media/video-indexer-view-menu.png)

1. **[タイムライン]** ペインに次のものが含まれていることを確認します。
    - 音声ナレーションのトランスクリプト。
    - 動画に表示されるテキスト。
    - 動画に登場するスピーカーの表示。 よく知られている人の中には、名前で自動的に認識される人もいれば、番号で示される人もいます (たとえば、*スピーカー #1*)。
1. **[インサイト]** ペインに戻り、そこに表示されるインサイトを表示します。 これには次のようなものがあります。
    - ビデオに表示される個々の人。
    - ビデオで議論されたトピック。
    - ビデオに表示されるオブジェクトのラベル。
    - ビデオに表示される人物やブランドなどの名前付きエンティティ。
    - キー シーン。
1. **[インサイト]** ペインが表示されている状態で、**[ビュー]** 記号を再度選択し、インサイトのリストで **[キーワード]** と **[感情]** をペインに追加します。

    見つかったインサイトは、動画の主なテーマを決定するのに役立ちます。 たとえば、この動画の**トピック**は、テクノロジー、社会的責任、および倫理に関するものであることを明確に示しています。

## インサイトを検索する

Video Indexer を使用して、動画でインサイトを検索できます。

1. **[インサイト]** ペインの **[検索]** ボックスに、「*Bee*」と入力します。 すべてのタイプのインサイトの結果を表示するには、[インサイト] ペインを下にスクロールする必要がある場合があります。
1. 下に示されている動画の場所で、一致する *ラベル* が 1 つ見つかったことを確認します。
1. ミツバチの存在が示されているセクションの先頭を選択し、その時点で動画を表示します (動画を一時停止して慎重に選択する必要がある場合があります。ミツバチは短時間しか表示されません。)

    ![Video Indexer の Bee の検索結果](../media/video-indexer-search.png)

1. 動画のすべてのインサイトを表示するには、**[検索]** ボックスをクリアします。

## Video Indexer REST API を使用する

Video Indexer は、アカウントに動画をアップロードおよび管理するために使用できる REST API を提供します。

1. ブラウザーの新しいタブで、[Azure portal](https://portal.azure.com) (`https://portal.azure.com`) を開き、Azure 資格情報を使用してサインインします。 Video Indexer ポータルを表示した既存のタブを開いたままにしておきます。
1. Azure portal で、ページ上部の検索バーの右側にある **[\>_]** ボタンを使用して、Azure portal に新しい Cloud Shell を作成し、サブスクリプションにストレージがない ***PowerShell*** 環境を選択します。

    Azure portal の下部にあるペインに Cloud Shell のコマンド ライン インターフェイスが表示されます。

    > **注**: *Bash* 環境を使用するクラウド シェルを以前に作成した場合は、それを ***PowerShell*** に切り替えます。

    > **注**:ファイルを保持するストレージを選択するようにポータルから求められた場合は、**[ストレージ アカウントは不要です]** を選択し、お使いのサブスクリプションを選択して、**[適用]** を選択します。

1. Cloud Shell ツール バーの **[設定]** メニューで、**[クラシック バージョンに移動]** を選択します (これはコード エディターを使用するのに必要です)。

    **<font color="red">続行する前に、クラシック バージョンの Cloud Shell に切り替えたことを確認します。</font>**

1. Cloud Shell ペインをサイズ変更して、さらに多くの内容を表示できるようにします。

    > **ヒント**" 上部の境界線をドラッグすると、ペインのサイズを変更できます。 最小化ボタンと最大化ボタンを使用して、Cloud Shell とメイン ポータル インターフェイスを切り替えることもできます。

1. Cloud Shell 画面で、次のコマンドを入力して、この演習のコード ファイルを含む GitHub リポジトリをクローンします (コマンドを入力するか、クリップボードにコピーしてから、コマンド ラインで右クリックし、プレーンテキストとして貼り付けます)。

    ```
    rm -r mslearn-ai-vision -f
    git clone https://github.com/MicrosoftLearning/mslearn-ai-vision
    ```

    > **ヒント**: Cloudshell にコマンドを貼り付けると、出力が大量のスクリーン バッファーを占有する可能性があります。 `cls` コマンドを入力して、各タスクに集中しやすくすることで、スクリーンをクリアできます。

1. リポジトリが複製されたら、この演習のアプリケーション コードが含まれているフォルダーに移動します。  

    ```
   cd mslearn-ai-vision/Labfiles/video-indexer
    ```

### API の詳細を取得する

Video Indexer APIを使用するには、リクエストを認証するための情報が必要です。

1. Video Indexer ポータルで、左側のウィンドウを展開し、**[アカウント設定]** ページを選択します。
1. このページの**アカウント ID** に注意してください。後で必要になります。
1. ブラウザーの新しいタブを開き、[Video Indexer 開発者ポータル](https://api-portal.videoindexer.ai) (https://api-portal.videoindexer.ai) に移動し、Azure 資格情報を使用してサインインします。
1. **[プロファイル]** ページで、プロファイルに関連付けられた**サブスクリプション**を表示します。
1. サブスクリプションのあるページで、サブスクリプションごとに 2 つのキー (プライマリとセカンダリ) が割り当てられていることを確認します。 次に、いずれかのキーの **[表示]** を選択して表示します。 このキーはまもなく必要になります。

### REST API を使用する

アカウント ID と API キーを取得したので、REST API を使用してアカウント内の動画を操作できます。 この手順では、PowerShell スクリプトを使用して REST 呼び出しを行います。ただし、cURL や Postman などの HTTP ユーティリティ、または JSON over HTTP を送受信できるプログラミング言語にも同じ原則が適用されます。

Video Indexer REST API とのすべての対話は、同じパターンに従います。

- ヘッダーに API キーを含む **AccessToken** メソッドへの最初の要求は、アクセス トークンを取得するために使用されます。
- 後続のリクエストは、REST メソッドを呼び出して動画を操作するときに、アクセス トークンを使用して認証します。

1. Cloud Shell で、次のコマンドを使用して PowerShell スクリプトを開きます。

    ```
   code get-videos.ps1
    ```
    
1. PowerShell スクリプトで、**YOUR_ACCOUNT_ID** および **YOUR_API_KEY** プレースホルダーを、以前に識別したアカウント ID および API キーの値に置き換えます。
1. 無料アカウントの *location* が "trial" であることに注意してください。 無制限の Video Indexer アカウント (関連付けられた Azure リソースを含む) を作成した場合は、これを Azure リソースがプロビジョニングされている場所 (「eastus」など) に変更できます。
1. スクリプトのコードを確認し、2 つの REST メソッドを呼び出すことに注意してください。1 つはアクセス トークンを取得するためのもので、もう 1 つはアカウント内の動画を一覧表示するためのものです。
1. 変更を保存し (*Ctrl + S* キーを押す)、コード エディターを閉じ (*Ctrl + Q* キーを押す)、次のコマンドを実行してスクリプトを実行します。

    ```
   ./get-videos.ps1
    ```
    
1. REST サービスからの JSON 応答を表示します。これには、以前にインデックスを作成した**責任のある AI** 動画の詳細が含まれているはずです。

## Video Indexer ウィジェットを使用する

Video Indexer サーポータルは、動画インデックス プロジェクトを管理するための便利なインターフェイスです。 ただし、Video Indexer アカウントにアクセスできないユーザーが動画とそのインサイトを利用できるようにしたい場合があります。 Video Indexer は、この目的のために Web ページに埋め込むことができるウィジェットを提供します。

1. `ls` コマンドを使用して、**video-indexer** フォルダーの内容を表示します。 これには、**analyze-video.html** ファイルが含まれていることに注意してください。 これは、Video Indexer の **[プレーヤー]** ウィジェットと **[インサイト]** ウィジェットを追加する基本的な HTML ページです。
1. 次のコマンドを入力して、そのファイルを編集します。

    ```
   code analyze-video.html
    ```

    このファイルをコード エディターで開きます。
   
1. ヘッダー内の **vb.widgets.mediator.js** スクリプトへの参照に注意してください。このスクリプトにより、ページ上の複数の Video Indexer ウィジェットが相互に対話できるようになります。
1. Video Indexer ポータルで、**[メディア ファイル]** ページに戻り、**責任ある AI** 動画を開きます。
1. ビデオ プレーヤーの下の **[&lt;/&gt; 埋め込み]** を選択し、HTML iframe コードを表示して、ウィジェットを埋め込みます。
1. **[共有と埋め込み]** ダイアログ ボックスで、**[プレーヤー]** ウィジェットを選択し、動画サイズを 560 x 315 に設定してから、埋め込みコードをクリップボードにコピーします。
1. Azure portal で Cloud Shell を開始し、**analyze-video.html** ファイルのコード エディターで、**&lt;-- Player widget goes here -- &gt;** というコメントの下に、コピーしたコードを貼り付けます。
1. Video Indexer ポータルに戻り、**[共有と埋め込み]** ダイアログで、**[分析情報]** ウィジェットを選択し、埋め込みコードをクリップボードにコピーします。 この後、**[共有と埋め込み]** ダイアログ ボックスを閉じ、Azure portal に切り替えて、**&lt;-- Insights widget goes here -- &gt;** というコメントの下に、コピーしたコードを貼り付けます。
1. ファイルを編集したら、コード エディター内で、変更を保存してから (*Ctrl + S* キー)、Cloud Shell コマンド ラインを開いたまま、コード エディターを閉じます (*Ctrl + Q* キー)。
1. Cloud Shell ツール バーで、次の (Cloud Shell 固有の) コマンドを入力して、編集した HTML ファイルをダウンロードします。

    ```
    download analyze-video.html
    ```

    ダウンロード コマンドを実行すると、ブラウザーの右下にポップアップ リンクが作成され、ここからファイルをダウンロードして開くことができます。次のようになります。

    ![Web ページの Video Indexer ウィジェット](../media/video-indexer-widgets.png)

1. **[インサイト]** ウィジェットを使用してウィジェットを試して、「insights」を検索し、動画内でそれらにジャンプします。

